From 57a9702d636503d718e6f2bd24c687284a00acc1 Mon Sep 17 00:00:00 2001
From: Shuhao Wu <shuhao@shuhaowu.com>
Date: Fri, 9 Jul 2021 20:59:03 -0400
Subject: [PATCH] Amber alerts notifications are properly routed

Change-Id: Idd460a41189204c194b197eb2f0daa3a442c268d
---
 .../cellbroadcastreceiver/CellBroadcastAlertService.java    | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/com/android/cellbroadcastreceiver/CellBroadcastAlertService.java b/src/com/android/cellbroadcastreceiver/CellBroadcastAlertService.java
index ee92eee7..bc8a8b2c 100644
--- a/src/com/android/cellbroadcastreceiver/CellBroadcastAlertService.java
+++ b/src/com/android/cellbroadcastreceiver/CellBroadcastAlertService.java
@@ -360,7 +360,11 @@ public class CellBroadcastAlertService extends Service
         // Either shown the dialog, adding it to notification (non emergency, or delayed emergency),
         CellBroadcastChannelManager channelManager = new CellBroadcastChannelManager(
                 mContext, cbm.getSubscriptionId());
-        if (channelManager.isEmergencyMessage(cbm) && !sRemindAfterCallFinish) {
+
+        String messageBody = cbm.getMessageBody().toLowerCase();
+        boolean isAmberAlert = messageBody.contains("amber") || messageBody.contains("abduction");
+
+        if (channelManager.isEmergencyMessage(cbm) && !sRemindAfterCallFinish && !isAmberAlert) {
             // start alert sound / vibration / TTS and display full-screen alert
             openEmergencyAlertNotification(cbm);
         } else {
-- 
2.25.1

